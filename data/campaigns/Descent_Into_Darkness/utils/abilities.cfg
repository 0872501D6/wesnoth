#textdomain wesnoth-did

############## DRAGON ABILITIES ##############

#define ABILITY_SOUL_EATER1
    [dummy]
        id=did_soul_eater1
        name= _ "soul eater"
        name_inactive= _ "soul eater"
        description= _ "This unit heals 4 HP whenever it kills an enemy unit."
        description_inactive= _ "This unit heals 4 HP whenever it kills an enemy unit."
    [/dummy]
#enddef

#define DID_SOUL_EATER1
    [event]
        id=did_soul_eater_die1
        name=die
        first_time_only=no
        [filter_second]
            ability=did_soul_eater1
        [/filter_second]

        [heal_unit]
            [filter]
                x,y=$x2,$y2
            [/filter]
            amount=4
            animate=yes
        [/heal_unit]
    [/event]
#enddef

#define ABILITY_SOUL_EATER2
    [dummy]
        id=did_soul_eater2
        name= _ "soul eater"
        name_inactive= _ "soul eater"
        description= _ "This unit heals 8 HP whenever it kills an enemy unit."
        description_inactive= _ "This unit heals 8 HP whenever it kills an enemy unit."
    [/dummy]
#enddef

#define DID_SOUL_EATER2
    [event]
        id=did_soul_eater_die2
        name=die
        first_time_only=no
        [filter_second]
            ability=did_soul_eater2
        [/filter_second]

        [heal_unit]
            [filter]
                x,y=$x2,$y2
            [/filter]
            amount=8
            animate=yes
        [/heal_unit]
    [/event]
#enddef

#define ABILITY_SOUL_EATER3
    [damage]
        id=did_soul_eater3
        name= _ "soul eater"
        name_inactive= _ "soul eater"
        description= _ "This unit gains 15% damage on offense and heals 12 HP whenever it kills an enemy unit."
        description_inactive= _ "This unit gains 15% damage on offense and heals 12 HP whenever it kills an enemy unit."
        multiply=1.15
        active_on=offense
    [/damage]
#enddef

#define DID_SOUL_EATER3
    [event]
        id=did_soul_eater_die3
        name=die
        first_time_only=no
        [filter_second]
            ability=did_soul_eater3
        [/filter_second]

        [heal_unit]
            [filter]
                x,y=$x2,$y2
            [/filter]
            amount=12
            animate=yes
        [/heal_unit]
    [/event]
#enddef

############## LICH ABILITIES ##############

#define ABILITY_MALICE15
    [leadership]
        id=did_malice15
        value=15
        cumulative=no
        affect_self=no
        name= _ "malice"
        description= _ "This unit increases the damage of nearby undead units by 15%."
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                race=undead
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_MALICE25
    [leadership]
        id=did_malice25
        value=25
        cumulative=no
        affect_self=no
        name= _ "malice"
        description= _ "This unit increases the damage of nearby undead units by 25%."
        [affect_adjacent]
            adjacent=n,ne,se,s,sw,nw
            [filter]
                race=undead
            [/filter]
        [/affect_adjacent]
    [/leadership]
#enddef

#define ABILITY_SHADOW_VEIL
    [dummy]
        id=did_shadow_veil
        name= _ "shadow veil"
        name_inactive= _ "shadow veil"
        description= _ "Allied undead units within a 5 hex radius are hidden."
        description_inactive= _ "Allied undead units within a 5 hex radius are hidden."
    [/dummy]
#enddef

#define ABILITY_SHADOW_VEIL_HELPER
    [hides]
        id=did_shadow_veil_helper
        affect_self=yes
        name= _ "veiled"
        description= _ "This unit is hidden."
    [/hides]
#enddef

#define DID_SHADOW_VEIL_HANDLER
    [event]
        name=moveto
        first_time_only=no
        [filter]
            side=1
            race=undead
        [/filter]

        [if]
            [have_unit]
                x,y=$x1,$y1
                [filter_location]
                    radius=5
                    [and]
                        [filter]
                            ability=did_shadow_veil
                            side=1
                        [/filter]
                    [/and]
                [/filter_location]
            [/have_unit]
            [then]
                [sound]
                    name="wail-sml.wav"
                [/sound]
                [object]
                    take_only_once=no
                    silent=yes
                    duration=forever
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    [effect]
                        apply_to=new_ability
                        [abilities]
                            {ABILITY_SHADOW_VEIL_HELPER}
                        [/abilities]
                    [/effect]
                [/object]
            [/then]
            [else]
                [object]
                    take_only_once=no
                    silent=yes
                    duration=forever
                    [filter]
                        x,y=$x1,$y1
                    [/filter]
                    [effect]
                        apply_to=remove_ability
                        [abilities]
                            {ABILITY_SHADOW_VEIL_HELPER}
                        [/abilities]
                    [/effect]
                [/object]
            [/else]
        [/if]
    [/event]
#enddef

#define WEAPON_SPECIAL_FROST_NOVA
    [dummy]
        id=did_frost_nova
        name= _ "frost nova"
        name_inactive= _ "frost nova"
        description= _ "On offense, this attack will additionally deal 70% of its damage in cold damage to all enemies adjacent to the target."
        description_inactive= _ "On offense, this attack will additionally deal 70% of its damage in cold damage to all enemies adjacent to the target."
    [/dummy]
#enddef

#define DID_FROST_NOVA
    [event]
        name=attacker_hits
        first_time_only=no
        [filter_attack]
            special=did_frost_nova
        [/filter_attack]
        [store_unit]
            [filter]
                [filter_adjacent]
                    x,y=$x2,$y2
                    is_enemy=no
                [/filter_adjacent]
                [not]
                    x,y=$x2,$y2
                [/not]
            [/filter]
            variable=opp
        [/store_unit]
        {VARIABLE frost_damage $damage_inflicted}
        {VARIABLE_OP frost_damage multiply 0.7}
        [foreach]
            array=opp
            [do]
                [sound]
                    name="magic-dark.ogg"
                [/sound]
                [harm_unit]
                    [filter]
                        x,y=$opp[$i].x,$opp[$i].y
                    [/filter]
                    fire_event=yes
                    animate=yes
                    amount=$frost_damage
                    damage_type=cold
                    delay=25
                [/harm_unit]
                [if]
                    [have_unit]
                        x,y=$opp[$i].x,$opp[$i].y
                    [/have_unit]
                    [else]
                        {VARIABLE exp $opp[$i].level}
                        {VARIABLE_OP exp multiply 8}
                        {VARIABLE_OP unit.experience add "$(max(4, $exp))"}
                        {CLEAR_VARIABLE exp}
                        [unstore_unit]
                            variable=unit
                            find_vacant=no
                        [/unstore_unit]
                    [/else]
                [/if]
            [/do]
        [/foreach]
        {CLEAR_VARIABLE opp}
        {CLEAR_VARIABLE frost_damage}
    [/event]
#enddef

#define WEAPON_SPECIAL_SPELLBIND
    [damage]
        id=did_spellbind
        name= _ "spell bind"
        name_inactive= _ "spell bind"
        description= _ "When this attack is used, all spell damage taken will be reduced by 60%."
        description_inactive= _ "When this attack is used, all spell damage taken will be reduced by 60%."
        [filter_opponent]
            [filter_weapon]
                type=fire,cold,arcane
            [/filter_weapon]
        [/filter_opponent]
        apply_to=opponent
        multiply=0.4
    [/damage]
#enddef

#define WEAPON_SPECIAL_REAP
    [drains]
        id=did_reap
        value=70
        name= _ "reap"
        description= _ "This unit heals for 70% of the damage this attack deals."
    [/drains]
#enddef

#define ABILITY_SOUL_REND
    [dummy]
        id=did_soul_rend
        name= _ "soul rend"
        name_inactive= _ "soul rend"
        description= _ "Every turn, this unit loses 5 hitpoints, but drains 3 hitpoints from each adjacent enemy."
        description_inactive= _ "Every turn, this unit loses 5 hitpoints, but drains 3 hitpoints from each adjacent enemy."
    [/dummy]
#enddef

#define DID_SOUL_REND
    [event]
        name=new turn
        first_time_only=no

        [store_unit]
            [filter]
                [filter_adjacent]
                    ability=did_soul_rend
                    is_enemy=yes
                [/filter_adjacent]
            [/filter]
            variable=opp
        [/store_unit]
        [store_unit]
            [filter]
                ability=did_soul_rend
            [/filter]
            variable=unit
        [/store_unit]

        [harm_unit]
            [filter]
                ability=did_soul_rend
            [/filter]

            amount=5
            animate=no
            kill=no
        [/harm_unit]

        [floating_text]
           x,y=$unit.x,$unit.y
           text="<span color='#ff0000'>" + "5" + "</span>"
        [/floating_text]

        {VARIABLE counter 0}
        [foreach]
            array=opp
            [do]
                {VARIABLE_OP counter add 1}
                [sound]
                    name="poison.ogg"
                [/sound]
                [harm_unit]
                    [filter]
                        x,y=$opp[$i].x,$opp[$i].y
                    [/filter]
                    fire_event=yes
                    animate=yes
                    amount=3
                    delay=25
                [/harm_unit]
                [if]
                    [have_unit]
                        x,y=$opp[$i].x,$opp[$i].y
                    [/have_unit]
                    [else]
                        {VARIABLE exp $opp[$i].level}
                        {VARIABLE_OP exp multiply 8}
                        {VARIABLE_OP unit.experience add $exp}
                        {CLEAR_VARIABLE exp}
                        [unstore_unit]
                            variable=unit
                            find_vacant=no
                        [/unstore_unit]
                    [/else]
                [/if]
            [/do]
        [/foreach]
        {VARIABLE_OP counter multiply 3}
        [heal_unit]
            [filter]
                ability=did_soul_rend
            [/filter]
            amount=$counter
            animate=yes
        [/heal_unit]
        {CLEAR_VARIABLE opp}
        {CLEAR_VARIABLE unit}
        {CLEAR_VARIABLE counter}
    [/event]
#enddef
