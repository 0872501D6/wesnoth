{GENERIC_UNIT_TEST "cve_2018_1999023" (
    [lua]
        code = << pcall(function() wesnoth.dofile("test/scenarios/bytecode.lua") end) >>
    [/lua]
    [lua]
        code = << pcall(function() wesnoth.require("test/scenarios/bytecode.lua") end) >>
    [/lua]
    [lua]
        code = <<
		local function f1()
			bytecode_executed = true
		end
		local f2, err = load(string.dump(f1))
		if f2 then
			f2()
		end
		>>
    [/lua]
    [event]
        name = prestart
        [lua]
        code = <<
			wml.variables["execution_prevented"] = not rawget(_G, "bytecode_executed")
        >>
        [/lua]
        {ASSERT ({VARIABLE_CONDITIONAL execution_prevented equals yes})}
        {SUCCEED}
    [/event]
)}
